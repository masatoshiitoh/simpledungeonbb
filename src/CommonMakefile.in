#
#      Copyright (C) 2010 by Masatoshi Itoh
#      http://www.simpledungeon.com/
#
#  This Program is free software; you can redistribute it and/or modify
#  it under the terms of the GNU General Public License as published by
#  the Free Software Foundation; either version 2, or (at your option)
#  any later version.
#
#  This Program is distributed in the hope that it will be useful,
#  but WITHOUT ANY WARRANTY; without even the implied warranty of
#  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
#  GNU General Public License for more details.
#
#  You should have received a copy of the GNU General Public License
#  along with simple dungeon; see the file COPYING.  If not, write to
#  the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
#  http://www.gnu.org/copyleft/gpl.html
#

program = simpledungeon
objs = \
	simpledungeon.beam \
	battle_observer.beam \
	task.beam \
	battle.beam \
	throw.beam \
	unarmed.beam \
	character.beam \
	character_stream.beam \
	db.beam  \
	morningcall.beam \
	mout.beam \
	move.beam \
	npc.beam \
	path_finder.beam \
	test.beam \
	id_password.beam \
	mmoasp.beam \
	char_kv.beam \
	default.beam \
	online_character.beam \
	session.beam \
	initial_location.beam \
	list_to_know.beam \
	u.beam

.SUFFIXES: .erl .beam

all : $(objs)

simpledungeon.beam : simpledungeon.erl
battle_observer.beam : battle_observer.erl mmoasp.hrl
unarmed.beam : unarmed.erl mmoasp.hrl
battle.beam : battle.erl mmoasp.hrl
throw.beam : throw.erl mmoasp.hrl
character.beam : character.erl mmoasp.hrl
character_stream.beam : character_stream.erl mmoasp.hrl
db.beam : db.erl mmoasp.hrl
morningcall.beam : morningcall.erl mmoasp.hrl
mout.beam : mout.erl mmoasp.hrl
move.beam : move.erl mmoasp.hrl
npc.beam : npc.erl mmoasp.hrl
path_finder.beam : path_finder.erl mmoasp.hrl
task.beam : task.erl mmoasp.hrl
test.beam : test.erl mmoasp.hrl
mmoasp.beam :mmoasp.erl mmoasp.hrl
u.beam :u.erl mmoasp.hrl
char_kv.beam :char_kv.erl mmoasp.hrl
default.beam :default.erl mmoasp.hrl
online_character.beam :online_character.erl mmoasp.hrl
session.beam :session.erl mmoasp.hrl
initial_location.beam :initial_location.erl mmoasp.hrl
id_password.beam :id_password.erl mmoasp.hrl
list_to_know.beam :list_to_know.erl mmoasp.hrl

install : $(objs)
	$(COPY) *.beam $(DESTDIR)
	$(COPY) *.app $(DESTDIR)

.erl.beam:
	$(ERLC) $(ERLCFLAGS) $<

.PHONY: clean
clean:
	$(RM) $(objs)
	$(REMOVEDIR) Mnesia.nonode@nohost

test: $(objs)
	erl -pa . -pa $(YAWS_EBINDIR) -noshell -boot start_clean -s test run_tests_with_log -s init stop

test2: $(objs)
	erl -pa . -pa $(YAWS_EBINDIR) -noshell -boot start_clean -s test run_tests -s init stop

run: $(objs)
	erl -pa . -pa $(YAWS_EBINDIR) -boot start_clean -s simpledungeon start

